# 베이스라인 및 스레시홀드 계산 가이드

## 개요
본 시스템은 센서에서 수집한 진동 데이터의 정상 상태(베이스라인)를 먼저 학습한 후, 이를 기반으로 이상 상태를 판별합니다.

---

## 1. 베이스라인(Baseline) 계산

### 1.1 베이스라인이란?
**베이스라인**은 장비가 정상적으로 작동할 때의 진동 특성을 나타내는 통계적 기준값입니다.
- 정상 상태에서의 평균, 표준편차, RMS 등을 저장
- 이후 실시간 데이터와 비교하여 이상 여부 판단

### 1.2 베이스라인 수집 방법

#### **Step 1: 정상 상태 확인**
1. 장비가 정상 작동 중인 상태 확인
2. 외부 진동이 최소한인 환경 선택
3. 측정 시작 전 30초 이상 대기

#### **Step 2: 베이스라인 데이터 수집**
1. GUI의 **"Anomaly Detection"** 탭 선택
2. **기간 설정** (권장: 5~10분)
   - 최소 60초 이상 권장
   - 길수록 더 정확한 베이스라인
3. **"Start Baseline Collection"** 버튼 클릭

```
Baseline Collection 진행 화면:
┌─────────────────────────────┐
│ Baseline Collection         │
│ ─────────────────────────   │
│ Duration: [5] minutes       │
│ ┌─────────────┐             │
│ │   ▶ Start   │  ⏸ Stop    │
│ └─────────────┘             │
│                             │
│ Collected: 3000 samples    │
│ Elapsed: 5m 00s            │
└─────────────────────────────┘
```

#### **Step 3: 수집된 데이터 확인**
- 실시간 그래프 확인 (3축 속도, 변위)
- 통계 테이블 확인:
  | Axis | Count | Mean | Std | Min | Max | RMS |
  |------|-------|------|-----|-----|-----|-----|
  | VX   | 3000  | 5.2  | 1.8 | 2.1 | 12.4| 5.5 |

---

## 2. 시간 도메인 특성값(Time Domain Features) 계산

### 2.1 계산되는 특성값들

#### **RMS (Root Mean Square)**
```
RMS = √(1/N × Σ(x_i²))
```
- 의미: 신호의 전체 에너지 레벨
- 범위: 0 이상
- 진동 강도의 가장 중요한 지표

**예시:**
```
데이터: [1, 2, 3, 4, 5]
RMS = √((1² + 2² + 3² + 4² + 5²) / 5)
    = √((1 + 4 + 9 + 16 + 25) / 5)
    = √(55 / 5)
    = √11
    ≈ 3.32
```

#### **Peak (피크값)**
```
Peak = max(|x_i|)
```
- 의미: 신호의 최대 진폭
- 범위: 0 이상
- 순간적인 충격 감지

**예시:**
```
데이터: [1, 2, -8, 4, 5]
Peak = max(|1|, |2|, |-8|, |4|, |5|)
     = 8
```

#### **Mean (평균)**
```
Mean = (1/N) × Σ(x_i)
```
- 의미: 데이터의 평균값
- 센서 바이어스 확인

**예시:**
```
데이터: [1, 2, 3, 4, 5]
Mean = (1 + 2 + 3 + 4 + 5) / 5
     = 15 / 5
     = 3
```

#### **Std (표준편차)**
```
Std = √(1/N × Σ(x_i - Mean)²)
```
- 의미: 데이터의 분산 정도
- 값이 클수록 변동성이 큼

**예시:**
```
데이터: [1, 2, 3, 4, 5]
Mean = 3

Std = √(((1-3)² + (2-3)² + (3-3)² + (4-3)² + (5-3)²) / 5)
    = √((4 + 1 + 0 + 1 + 4) / 5)
    = √(10 / 5)
    = √2
    ≈ 1.41
```

#### **Crest Factor (크레스트 인수)**
```
Crest Factor = Peak / RMS
```
- 의미: 신호의 임펄스 강도
- 값이 클수록 충격성이 강함
- 일반적으로 3~4가 정상

**예시:**
```
Peak = 8, RMS = 3.32
Crest Factor = 8 / 3.32
             ≈ 2.41
```

### 2.2 베이스라인 저장 형식 (baseline.json)

```json
{
  "vx": {
    "rms": 5.234,
    "peak": 12.456,
    "mean": 5.123,
    "std": 1.823,
    "min": 1.234,
    "max": 12.456,
    "crest_factor": 2.38
  },
  "vy": {...},
  "vz": {...},
  "dx": {...},
  "dy": {...},
  "dz": {...},
  "ax": {...},
  "ay": {...},
  "az": {...},
  "temp": {...}
}
```

---

## 3. 스레시홀드(Threshold) 값 계산

### 3.1 스레시홀드란?
**스레시홀드**는 정상 상태와 이상 상태를 구분하는 경계값입니다.

### 3.2 스레시홀드 계산 방식

#### **공식**
```
Warning Threshold   = Mean + (Std × Multiplier)
Critical Threshold  = Mean + (Std × Multiplier × 1.5)
RMS Threshold       = RMS_baseline × (1 + Multiplier × 0.1)
```

#### **Std Multiplier (표준편차 배수)**
- **1.0**: 매우 민감 (오탐 가능성 높음)
- **2.0**: 권장값 (95% 정규분포 범위)
- **3.0**: 덜 민감 (이상 감지 어려움)
- **4.0**: 매우 덜 민감
- **5.0**: 극도로 덜 민감

GUI에서는 **1 ~ 5** 범위에서 선택 가능합니다.

### 3.3 실제 계산 예시

**베이스라인 정보:**
```
VX (X축 속도)
- Mean: 5.5 mm/s
- Std:  1.2 mm/s
- RMS:  5.8 mm/s
```

**Std Multiplier = 2.0 선택 시:**
```
Warning Threshold   = 5.5 + (1.2 × 2.0)
                   = 5.5 + 2.4
                   = 7.9 mm/s

Critical Threshold  = 5.5 + (1.2 × 2.0 × 1.5)
                   = 5.5 + 3.6
                   = 9.1 mm/s

RMS Threshold       = 5.8 × (1 + 2.0 × 0.1)
                   = 5.8 × 1.2
                   = 6.96 mm/s
```

### 3.4 상태 판별

```
┌─────────────────────────────────────┐
│         정상 범위                    │
│  Mean - Std × 2 ~ Mean + Std × 2   │
│       (3.1 ~ 7.9 mm/s)              │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│        경고 범위 (주의)              │
│   Mean + Std × 2 ~ Mean + Std × 3   │
│       (7.9 ~ 9.1 mm/s)              │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│      심각 범위 (위험)                │
│   > Mean + Std × 3                  │
│       (> 9.1 mm/s)                  │
└─────────────────────────────────────┘
```

---

## 4. GUI 사용 방법

### 4.1 베이스라인 수집

1. **"Anomaly Detection"** 탭 선택
2. **Baseline Collection** 섹션
   - Duration 설정 (기본 5분)
   - **"Start Baseline Collection"** 클릭
   - 진행 상황 모니터링

3. **"Calculate Thresholds"** 버튼 클릭
   - Std Multiplier 슬라이더로 조절 (1~5)
   - 결과 확인

### 4.2 스레시홀드 확인

**Real-time Monitoring 탭에서 확인:**
```
Threshold Status: Loaded (Std Multiplier: 2.0)

Axis Status:
VX: 5.8 mm/s / 7.9 mm/s [🟢 NORMAL]
VY: 8.2 mm/s / 7.9 mm/s [🟠 WARNING]
VZ: 4.5 mm/s / 7.9 mm/s [🟢 NORMAL]
```

### 4.3 베이스라인 저장/로드

- **저장**: "Calculate Thresholds" 버튼 클릭 후 자동 저장
- **로드**: "Load Baseline" 버튼으로 이전 저장 파일 로드

---

## 5. 실무 팁

### 5.1 베이스라인 수집 시기
- ✓ 장비 설치 직후
- ✓ 유지보수/수리 후
- ✓ 계절 변화로 인한 특성 변화 시
- ✓ 정기적으로 (월 1회 권장)

### 5.2 베이스라인 갱신 고려사항
- 베이스라인은 작업 조건에 맞게 수집
  - 일일 작업 조건과 동일한 환경에서 수집
  - 온도, 부하, 속도 등 동일하게 유지

### 5.3 Std Multiplier 선택
| Multiplier | 민감도 | 사용 환경 |
|-----------|-------|---------|
| 1.0 | 매우 높음 | 높은 정확도 필요 (오탐 주의) |
| 2.0 | 중간 | 일반적 사용 (권장) |
| 3.0 | 낮음 | 매우 시끄러운 환경 |
| 4.0 | 매우 낮음 | 극도의 노이즈 환경 |
| 5.0 | 극도로 낮음 | 특수 환경 |

### 5.4 베이스라인 검증
수집된 베이스라인이 유효한지 확인:
```
✓ 데이터 포인트: 최소 100개 이상
✓ RMS > 0 (신호 수신 확인)
✓ Std < Mean (정상적인 변동)
✓ Crest Factor: 2~4 범위
✓ 그래프: 지속적인 변동 패턴
```

---

## 6. 문제 해결

### Q: "Baseline is empty" 메시지가 표시됨
**A:** 
1. 베이스라인 데이터 재수집 필요
2. 센서 연결 확인
3. 충분한 시간 동안 수집 (최소 60초)

### Q: 스레시홀드가 너무 높아서 이상 감지 안 됨
**A:**
1. Std Multiplier 값 줄이기 (2.0 → 1.5)
2. 더 정상적인 조건에서 베이스라인 재수집
3. 외부 진동 제거 후 재수집

### Q: 거짓 경보(False Positive)가 너무 많음
**A:**
1. Std Multiplier 값 키우기 (2.0 → 3.0)
2. 더 길게 베이스라인 수집 (변동성 포함)
3. 센서 위치 안정화

### Q: 베이스라인 파일이 손실됨
**A:**
1. 최근 상태에서 베이스라인 재수집
2. GUI에서 "Load Baseline" 버튼으로 다시 로드
3. 정기적으로 baseline.json 백업 권장

---

## 7. 참고 자료

### ISO 표준
- ISO 10816: 진동 심각도 판정 기준
- ISO 20816: 회전 기계 진동 측정

### 관련 지표
| 지표 | 범위 | 의미 |
|-----|-----|------|
| RMS | 0~∞ | 전체 에너지 |
| Peak | 0~∞ | 최대 진폭 |
| Crest Factor | 1~∞ | 임펄스 강도 |
| Std | 0~∞ | 변동성 |

---

**작성일:** 2024년 12월
**버전:** 1.0
